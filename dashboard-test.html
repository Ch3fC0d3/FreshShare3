<!DOCTYPE html>
<html>
<head>
  <title>FreshShare Dashboard Test</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; }
    .card { background: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
            padding: 20px; margin-bottom: 20px; }
    .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
    .stat-card { background: #f8f9fa; padding: 15px; border-radius: 6px; text-align: center; }
    .stat-value { font-size: 24px; font-weight: bold; color: #007bff; }
    .stat-label { color: #6c757d; }
    button { padding: 8px 16px; background: #007bff; color: white; border: none; 
             border-radius: 4px; cursor: pointer; }
    button:hover { background: #0069d9; }
    .error { color: #dc3545; }
    .success { color: #28a745; }
  </style>
</head>
<body>
  <div class="card">
    <h1>FreshShare Dashboard Test</h1>
    <p>This page tests the connectivity between the frontend and backend API.</p>
    
    <div id="connection-status" class="card">
      <h2>API Connection Status</h2>
      <div id="connection-results">
        <p>Testing API connections...</p>
      </div>
    </div>
    
    <div class="card">
      <h2>Dashboard Statistics</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="total-users">--</div>
          <div class="stat-label">Total Users</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="active-sessions">--</div>
          <div class="stat-label">Active Sessions</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="total-products">--</div>
          <div class="stat-label">Total Products</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="new-orders">--</div>
          <div class="stat-label">New Orders</div>
        </div>
      </div>
      <div style="margin-top: 20px; text-align: center;">
        <button onclick="loadDashboardStats()">Refresh Dashboard Data</button>
      </div>
      <div id="dashboard-status" style="margin-top: 10px; text-align: center;"></div>
    </div>
  </div>

  <script src="/js/connection-test.js"></script>
  <script>
    // Function to load dashboard stats
    async function loadDashboardStats() {
      const statusElement = document.getElementById('dashboard-status');
      statusElement.innerHTML = 'Loading dashboard data...';
      statusElement.className = '';
      
      try {
        // First try port 3002
        const response = await fetch('http://localhost:3002/api/dashboard/stats', {
          signal: AbortSignal.timeout(3000)
        });
        
        if (response.ok) {
          const data = await response.json();
          
          if (data.success && data.stats) {
            document.getElementById('total-users').textContent = data.stats.totalUsers;
            document.getElementById('active-sessions').textContent = data.stats.activeSessions;
            document.getElementById('total-products').textContent = data.stats.totalProducts;
            document.getElementById('new-orders').textContent = data.stats.newOrders;
            
            statusElement.innerHTML = 'Dashboard data loaded successfully!';
            statusElement.className = 'success';
          } else {
            throw new Error('Invalid data format');
          }
        } else {
          throw new Error(`Server responded with status ${response.status}`);
        }
      } catch (error) {
        console.error('Failed to load dashboard stats:', error);
        statusElement.innerHTML = `Failed to load dashboard data: ${error.message}`;
        statusElement.className = 'error';
      }
    }
    
    // Load stats when page loads
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(loadDashboardStats, 1000); // Delay slightly to let connection test run first
    });
  </script>
</body>
</html>
