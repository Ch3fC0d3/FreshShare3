<%- contentFor('script') %>
<script src="/js/admin-page.js?v=<%= (typeof assetVersion !== 'undefined' ? assetVersion : Date.now()) %>"></script>

<div id="admin-root" class="main-container" data-current-user-id="<%= typeof currentUserId !== 'undefined' ? currentUserId : '' %>">
  <div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="h3 mb-0">Admin Dashboard</h1>
      <a href="/dashboard" class="btn btn-link"><i class="fas fa-chevron-left"></i> Back</a>
    </div>

    <div class="card mt-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h2 class="h5 mb-0">Users</h2>
        <div class="d-flex gap-2">
          <input id="admin-users-q" type="search" class="form-control form-control-sm" placeholder="Search username or email">
          <button id="admin-users-search" class="btn btn-sm btn-outline-primary">Search</button>
        </div>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-striped table-hover mb-0">
            <thead>
              <tr>
                <th>Username</th>
                <th>Email</th>
                <th>Roles</th>
                <th>Created</th>
                <th>Last Login</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="admin-users-tbody">
              <tr><td colspan="5" class="text-muted">Loading…</td></tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="card-footer d-flex justify-content-between align-items-center">
        <div class="small text-muted" id="admin-users-summary"></div>
        <nav>
          <ul class="pagination pagination-sm mb-0" id="admin-users-pagination"></ul>
        </nav>
      </div>
    </div>

    <div class="row g-3">
      <div class="col-md-3">
        <div class="card text-center">
          <div class="card-body">
            <div class="text-muted small">Users</div>
            <div id="stat-users" class="display-6">—</div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center">
          <div class="card-body">
            <div class="text-muted small">Listings</div>
            <div id="stat-listings" class="display-6">—</div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center">
          <div class="card-body">
            <div class="text-muted small">Orders</div>
            <div id="stat-orders" class="display-6">—</div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center">
          <div class="card-body">
            <div class="text-muted small">Messages</div>
            <div id="stat-messages" class="display-6">—</div>
          </div>
        </div>
      </div>
    </div>

    <div class="card mt-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h2 class="h5 mb-0">Management</h2>
      </div>
      <div class="card-body">
        <div class="list-group">
          <a href="/marketplace" class="list-group-item list-group-item-action"><i class="fas fa-store me-2"></i>Manage Listings</a>
          <a href="/groups" class="list-group-item list-group-item-action"><i class="fas fa-users me-2"></i>Manage Groups</a>
          <a href="/messages" class="list-group-item list-group-item-action"><i class="fas fa-envelope me-2"></i>Moderate Messages</a>
        </div>
      </div>
    </div>

    <div class="card mt-4">
      <div class="card-header"><h2 class="h5 mb-0">System Utilities</h2></div>
      <div class="card-body">
        <div class="d-flex gap-2 flex-wrap">
          <a class="btn btn-outline-secondary" href="/api/health/db" target="_blank">DB Health</a>
          <a class="btn btn-outline-secondary" href="/api" target="_blank">API Index</a>
        </div>
      </div>
    </div>

    <div class="card mt-4" id="admin-audit">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h2 class="h5 mb-0">Audit Log</h2>
        <div class="d-flex align-items-center gap-2">
          <label class="small text-muted">Show</label>
          <select id="audit-limit" class="form-select form-select-sm" style="width:auto">
            <option value="50">50</option>
            <option value="100" selected>100</option>
            <option value="200">200</option>
            <option value="500">500</option>
          </select>
          <button id="audit-refresh" class="btn btn-sm btn-outline-secondary"><i class="fas fa-rotate"></i> Refresh</button>
        </div>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-striped table-hover mb-0">
            <thead>
              <tr>
                <th style="width: 18%">Timestamp</th>
                <th style="width: 8%">Level</th>
                <th style="width: 16%">Action</th>
                <th style="width: 18%">Actor</th>
                <th style="width: 18%">Target</th>
                <th>Details</th>
              </tr>
            </thead>
            <tbody id="admin-audit-tbody">
              <tr><td colspan="6" class="text-muted">Loading…</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

</div>
